{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tristanwhite/IdeaProjects/jbook/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tristanwhite/IdeaProjects/jbook/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as esbuild from'esbuild-wasm';import{unpkgPathPlugin}from'./plugins/unpkg-path-plugins';import{fetchPlugin}from'./plugins/fetch-plugin';var service;var bundle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawCode){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(service){_context.next=4;break;}_context.next=3;return esbuild.startService({worker:true,wasmURL:'https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm'});case 3:service=_context.sent;case 4:_context.prev=4;_context.next=7;return service.build({entryPoints:['index.ts'],bundle:true,write:false,plugins:[unpkgPathPlugin(),fetchPlugin(rawCode)],define:{'process.env.NODE_ENV':'\"production\"',global:'window'},jsxFactory:'_React.createElement',jsxFragment:'_React.Fragment'});case 7:result=_context.sent;return _context.abrupt(\"return\",{code:result.outputFiles[0].text,err:''});case 11:_context.prev=11;_context.t0=_context[\"catch\"](4);return _context.abrupt(\"return\",{code:'',err:_context.t0.message});case 14:case\"end\":return _context.stop();}}},_callee,null,[[4,11]]);}));return function bundle(_x){return _ref.apply(this,arguments);};}();export default bundle;","map":{"version":3,"sources":["/Users/tristanwhite/IdeaProjects/jbook/packages/local-client/src/bundler/index.ts"],"names":["esbuild","unpkgPathPlugin","fetchPlugin","service","bundle","rawCode","startService","worker","wasmURL","build","entryPoints","write","plugins","define","global","jsxFactory","jsxFragment","result","code","outputFiles","text","err","message"],"mappings":"mWAAA,MAAO,GAAKA,CAAAA,OAAZ,KAAyB,cAAzB,CACA,OAASC,eAAT,KAAgC,8BAAhC,CACA,OAASC,WAAT,KAA4B,wBAA5B,CAEA,GAAIC,CAAAA,OAAJ,CACA,GAAMC,CAAAA,MAAM,0FAAG,iBAAOC,OAAP,gIACPF,OADO,+CAESH,CAAAA,OAAO,CAACM,YAAR,CAAqB,CACjCC,MAAM,CAAE,IADyB,CAEjCC,OAAO,CAAE,oDAFwB,CAArB,CAFT,QAEPL,OAFO,4DAQcA,CAAAA,OAAO,CAACM,KAAR,CAAc,CAC/BC,WAAW,CAAE,CAAC,UAAD,CADkB,CAE/BN,MAAM,CAAE,IAFuB,CAG/BO,KAAK,CAAE,KAHwB,CAI/BC,OAAO,CAAE,CAACX,eAAe,EAAhB,CAAoBC,WAAW,CAACG,OAAD,CAA/B,CAJsB,CAK/BQ,MAAM,CAAE,CACJ,uBAAwB,cADpB,CAEJC,MAAM,CAAE,QAFJ,CALuB,CAS/BC,UAAU,CAAE,sBATmB,CAU/BC,WAAW,CAAE,iBAVkB,CAAd,CARd,QAQDC,MARC,+CAqBA,CACHC,IAAI,CAAED,MAAM,CAACE,WAAP,CAAmB,CAAnB,EAAsBC,IADzB,CAEHC,GAAG,CAAE,EAFF,CArBA,4FA0BA,CACHH,IAAI,CAAE,EADH,CAEHG,GAAG,CAAE,YAAIC,OAFN,CA1BA,uEAAH,kBAANlB,CAAAA,MAAM,4CAAZ,CAmCA,cAAeA,CAAAA,MAAf","sourcesContent":["import * as esbuild from 'esbuild-wasm';\nimport { unpkgPathPlugin } from './plugins/unpkg-path-plugins';\nimport { fetchPlugin } from './plugins/fetch-plugin';\n\nlet service: esbuild.Service;\nconst bundle = async (rawCode: string) => {\n    if(!service) {\n        service = await esbuild.startService({\n            worker: true,\n            wasmURL: 'https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm',\n        });\n    }\n    try {\n        const result = await service.build({\n            entryPoints: ['index.ts'],\n            bundle: true,\n            write: false,\n            plugins: [unpkgPathPlugin(), fetchPlugin(rawCode)],\n            define: {\n                'process.env.NODE_ENV': '\"production\"',\n                global: 'window',\n            },\n            jsxFactory: '_React.createElement',\n            jsxFragment: '_React.Fragment'\n        });\n\n        return {\n            code: result.outputFiles[0].text,\n            err: ''\n        }\n    } catch (err){\n        return {\n            code: '',\n            err: err.message\n        }\n    }\n\n\n};\n\nexport default bundle;\n"]},"metadata":{},"sourceType":"module"}